<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FactoryAI æ™ºå·¥åŠ©æ‰‹</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a5f;
            --primary-light: #2d5a8a;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
        
        /* Login */
        .login-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); padding: 20px; }
        .login-box { background: var(--card); border-radius: 16px; padding: 30px; width: 100%; max-width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
        .login-logo { text-align: center; margin-bottom: 24px; }
        .login-logo h1 { font-size: 24px; color: var(--primary); margin-bottom: 6px; }
        .login-logo p { color: var(--text-light); font-size: 13px; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; }
        .form-input { width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 10px; font-size: 14px; outline: none; }
        .form-input:focus { border-color: var(--primary); }
        .form-select { width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 10px; font-size: 14px; background: white; }
        .btn { padding: 12px 20px; border: none; border-radius: 10px; font-size: 14px; font-weight: 500; cursor: pointer; width: 100%; }
        .btn-primary { background: var(--primary); color: white; }
        .btn:active { transform: scale(0.98); }
        
        /* App */
        .app-container { display: none; min-height: 100vh; }
        .app-container.active { display: block; }
        
        /* Header */
        .header { background: var(--primary); color: white; padding: 14px 16px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
        .header-title { font-size: 16px; font-weight: 600; }
        .header-info { display: flex; align-items: center; gap: 10px; font-size: 12px; }
        .role-badge { background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px; font-size: 11px; }
        
        /* User Bar */
        .user-bar { background: var(--card); padding: 12px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
        .user-avatar { width: 44px; height: 44px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .user-info { flex: 1; }
        .user-name { font-size: 15px; font-weight: 600; }
        .user-role { font-size: 12px; color: var(--text-light); }
        
        /* Tabs */
        .tabs { display: flex; background: var(--card); border-bottom: 1px solid var(--border); overflow-x: auto; }
        .tab { flex: 1; min-width: 60px; padding: 12px 8px; text-align: center; font-size: 11px; color: var(--text-light); cursor: pointer; border-bottom: 2px solid transparent; white-space: nowrap; }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600; }
        .tab i { display: block; font-size: 18px; margin-bottom: 2px; }
        
        .content { padding: 16px; display: none; }
        .content.active { display: block; }
        
        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 16px; }
        .stat-card { background: var(--card); padding: 14px 10px; border-radius: 12px; text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .stat-value { font-size: 22px; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 10px; color: var(--text-light); margin-top: 4px; }
        .stat-card.warning .stat-value { color: var(--warning); }
        .stat-card.danger .stat-value { color: var(--danger); }
        .stat-card.success .stat-value { color: var(--success); }
        
        .card { background: var(--card); border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .card-title { font-size: 15px; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        
        /* Dashboard for different roles */
        .role-dashboard { }
        
        /* Production Dashboard */
        .kpi-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }
        .kpi-card { background: var(--card); border-radius: 12px; padding: 16px; text-align: center; }
        .kpi-value { font-size: 28px; font-weight: 700; }
        .kpi-value.green { color: var(--success); }
        .kpi-value.red { color: var(--danger); }
        .kpi-value.yellow { color: var(--warning); }
        .kpi-label { font-size: 12px; color: var(--text-light); margin-top: 4px; }
        
        /* Equipment Dashboard */
        .equipment-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .equip-card { background: var(--bg); border-radius: 10px; padding: 14px 10px; text-align: center; cursor: pointer; }
        .equip-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; font-size: 20px; }
        .equip-icon.normal { background: #dcfce7; color: #16a34a; }
        .equip-icon.warning { background: #fef3c7; color: #d97706; }
        .equip-icon.error { background: #fee2e2; color: #dc2626; }
        .equip-name { font-size: 12px; font-weight: 500; }
        .equip-status { font-size: 11px; color: var(--text-light); }
        
        /* Quality Dashboard */
        .quality-alert { display: flex; align-items: center; padding: 12px; background: #fef3c7; border-radius: 10px; margin-bottom: 10px; }
        .quality-alert.danger { background: #fee2e2; }
        .quality-icon { font-size: 24px; margin-right: 12px; }
        .quality-info { flex: 1; }
        .quality-title { font-size: 14px; font-weight: 500; }
        .quality-desc { font-size: 12px; color: var(--text-light); }
        
        /* Tasks */
        .task-item { display: flex; align-items: center; padding: 14px 0; border-bottom: 1px solid var(--border); cursor: pointer; }
        .task-item:last-child { border-bottom: none; }
        .task-item:active { background: var(--bg); margin: 0 -16px; padding-left: 16px; padding-right: 16px; }
        .task-priority { width: 4px; height: 40px; border-radius: 2px; margin-right: 12px; }
        .task-priority.high { background: var(--danger); }
        .task-priority.medium { background: var(--warning); }
        .task-priority.low { background: var(--success); }
        .task-info { flex: 1; }
        .task-name { font-size: 14px; font-weight: 500; margin-bottom: 4px; }
        .task-meta { font-size: 12px; color: var(--text-light); }
        .task-tag { font-size: 10px; padding: 2px 8px; border-radius: 10px; background: var(--bg); color: var(--text-light); }
        
        /* AI Planning */
        .ai-plan { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 16px; color: white; margin-bottom: 16px; cursor: pointer; }
        .ai-plan:active { transform: scale(0.98); }
        .ai-plan-title { font-size: 15px; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .ai-plan-desc { font-size: 13px; opacity: 0.9; }
        
        /* Records */
        .record-item { display: flex; align-items: center; padding: 14px 0; border-bottom: 1px solid var(--border); }
        .record-item:last-child { border-bottom: none; }
        .record-date { width: 50px; text-align: center; margin-right: 12px; }
        .record-day { font-size: 18px; font-weight: 700; color: var(--primary); }
        .record-month { font-size: 11px; color: var(--text-light); }
        .record-info { flex: 1; }
        .record-title { font-size: 14px; font-weight: 500; margin-bottom: 4px; }
        .record-stats { font-size: 12px; color: var(--text-light); }
        
        /* Admin */
        .admin-tabs { display: flex; gap: 8px; margin-bottom: 12px; overflow-x: auto; }
        .admin-tab { padding: 8px 14px; border-radius: 20px; font-size: 12px; background: var(--bg); color: var(--text-light); cursor: pointer; border: none; white-space: nowrap; }
        .admin-tab.active { background: var(--primary); color: white; }
        
        .data-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .data-table th, .data-table td { padding: 10px 6px; text-align: left; border-bottom: 1px solid var(--border); }
        .data-table th { font-weight: 600; color: var(--text-light); font-size: 11px; }
        
        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 16px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--card); border-radius: 16px; width: 100%; max-width: 500px; max-height: 85vh; overflow-y: auto; }
        .modal-header { padding: 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 16px; font-weight: 600; }
        .modal-close { width: 28px; height: 28px; border-radius: 50%; background: var(--bg); display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .modal-body { padding: 16px; }
        .modal-footer { padding: 12px 16px; border-top: 1px solid var(--border); display: flex; gap: 10px; }
        .modal-footer .btn { flex: 1; }
        .btn-secondary { background: var(--bg); color: var(--text); }
        
        /* Chat */
        .chat-box { height: 300px; display: flex; flex-direction: column; }
        .chat-messages { flex: 1; overflow-y: auto; }
        .message { display: flex; margin-bottom: 12px; }
        .message.user { flex-direction: row-reverse; }
        .message-avatar { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; }
        .message.user .message-avatar { background: var(--primary); color: white; }
        .message.ai .message-avatar { background: #667eea; color: white; }
        .message-content { max-width: 75%; padding: 10px 12px; border-radius: 12px; font-size: 13px; line-height: 1.5; margin: 0 8px; }
        .message.user .message-content { background: var(--primary); color: white; border-bottom-right-radius: 4px; }
        .message.ai .message-content { background: var(--bg); border-bottom-left-radius: 4px; }
        .chat-input { display: flex; gap: 8px; padding-top: 10px; border-top: 1px solid var(--border); }
        .chat-input input { flex: 1; padding: 10px 14px; border: 1px solid var(--border); border-radius: 20px; font-size: 13px; outline: none; }
        .chat-input button { width: 38px; height: 38px; border: none; background: var(--primary); color: white; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body>
    <!-- Login -->
    <div class="login-page" id="login-page">
        <div class="login-box">
            <div class="login-logo">
                <h1>ğŸ­ FactoryAI</h1>
                <p>æ™ºå·¥åŠ©æ‰‹ - è®©å·¥ä½œæ›´æ™ºèƒ½</p>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">é€‰æ‹©è§’è‰²ç™»å½•</label>
                    <select class="form-select" id="login-role" onchange="updateDemoInfo()">
                        <option value="production">ğŸ“¦ ç”Ÿç®¡å·¥ç¨‹å¸ˆ - ç”Ÿäº§æ’é…</option>
                        <option value="equipment">ğŸ”§ è®¾å¤‡å·¥ç¨‹å¸ˆ - è®¾å¤‡ç»´æŠ¤</option>
                        <option value="quality">âœ… å“ä¿å·¥ç¨‹å¸ˆ - å“è´¨ç®¡æ§</option>
                        <option value="engineer">ğŸ‘¨â€ğŸ’» å·¥ç¨‹å¸ˆ - é€šç”¨</option>
                        <option value="supervisor">ğŸ‘” ä¸»ç®¡ - å›¢é˜Ÿç®¡ç†</option>
                        <option value="executive">ğŸ“ˆ é«˜é˜¶ä¸»ç®¡ - å†³ç­–åˆ†æ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·å</label>
                    <input type="text" class="form-input" id="login-username" placeholder="è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" class="form-input" id="login-password" placeholder="è¾“å…¥å¯†ç " required>
                </div>
                <button type="submit" class="btn btn-primary">ç™»å½•</button>
            </form>
        </div>
    </div>
    
    <!-- Main App -->
    <div class="app-container" id="app-container">
        <div class="header">
            <div class="header-title">ğŸ­ FactoryAI</div>
            <div class="header-info">
                <span class="role-badge" id="header-role">ç”Ÿç®¡</span>
                <button onclick="logout()" style="background: transparent; border: none; color: white; font-size: 12px; cursor: pointer;">é€€å‡º</button>
            </div>
        </div>
        
        <div class="user-bar">
            <div class="user-avatar" id="user-avatar">ğŸ‘¤</div>
            <div class="user-info">
                <div class="user-name" id="user-name">ç”Ÿç®¡å·¥ç¨‹å¸ˆ</div>
                <div class="user-role" id="user-role">ç”Ÿäº§ç®¡ç†éƒ¨</div>
            </div>
            <button class="btn btn-primary" style="width: auto; padding: 8px 16px; font-size: 13px;" onclick="openAIPlanning()">ğŸ¤– AIè§„åˆ’</button>
        </div>
        
        <div class="tabs" id="main-tabs">
            <!-- Dynamic tabs will be rendered -->
        </div>
        
        <div id="tab-contents">
            <!-- Dynamic content will be rendered -->
        </div>
    </div>
    
    <!-- AI Planning Modal -->
    <div class="modal-overlay" id="ai-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">ğŸ¤– AI å·¥ä½œè§„åˆ’åŠ©æ‰‹</div>
                <div class="modal-close" onclick="closeModal()"><i class="ri-close-line"></i></div>
            </div>
            <div class="modal-body">
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 16px;">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">ğŸ¯ åŠŸèƒ½è¯´æ˜</div>
                    <div style="font-size: 13px; opacity: 0.9;">æè¿°æ‚¨æ¯å¤©çš„å·¥ä½œå†…å®¹ï¼ŒAIä¼šè‡ªåŠ¨åˆ†æå¹¶ç”Ÿæˆä¸ªæ€§åŒ–çš„å·¥ä½œä»»åŠ¡æ¸…å•</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">æè¿°æ‚¨çš„å·¥ä½œå†…å®¹</label>
                    <textarea class="form-input" id="work-desc" rows="4" placeholder="ä¾‹å¦‚ï¼šæˆ‘æ˜¯ç”Ÿç®¡å·¥ç¨‹å¸ˆï¼Œæ¯å¤©éœ€è¦ç¡®è®¤ç”Ÿäº§æ’é…è¾¾æˆæƒ…å†µï¼Œæ£€æŸ¥ç”Ÿäº§çº¿äº§èƒ½åˆ©ç”¨ç‡ï¼Œå¤„ç†ç¼ºæ–™é—®é¢˜ï¼Œåè°ƒå‡ºè´§..."></textarea>
                </div>
                
                <button class="btn btn-primary" onclick="runAIPlanning()">ğŸ¤– ç”Ÿæˆå·¥ä½œä»»åŠ¡</button>
                
                <div id="ai-result" style="display: none; margin-top: 16px;">
                    <div class="card-title">ğŸ“‹ ç”Ÿæˆçš„æ¯æ—¥ä»»åŠ¡</div>
                    <div id="ai-tasks"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ========== Role Configurations ==========
        const roles = {
            production: {
                name: 'ç”Ÿç®¡å·¥ç¨‹å¸ˆ',
                dept: 'ç”Ÿäº§ç®¡ç†éƒ¨',
                avatar: 'ğŸ“¦',
                tabs: ['é¦–é¡µ', 'æ’é…', 'ä»»åŠ¡', 'è®°å½•'],
                color: '#22c55e'
            },
            equipment: {
                name: 'è®¾å¤‡å·¥ç¨‹å¸ˆ',
                dept: 'è®¾å¤‡ç»´æŠ¤éƒ¨',
                avatar: 'ğŸ”§',
                tabs: ['é¦–é¡µ', 'è®¾å¤‡', 'ä¿å…»', 'è®°å½•'],
                color: '#3b82f6'
            },
            quality: {
                name: 'å“ä¿å·¥ç¨‹å¸ˆ',
                dept: 'å“è´¨ç®¡ç†éƒ¨',
                avatar: 'âœ…',
                tabs: ['é¦–é¡µ', 'å“è´¨', 'å¼‚å¸¸', 'è®°å½•'],
                color: '#f59e0b'
            },
            engineer: {
                name: 'å·¥ç¨‹å¸ˆ',
                dept: 'æŠ€æœ¯éƒ¨',
                avatar: 'ğŸ‘¨â€ğŸ’»',
                tabs: ['é¦–é¡µ', 'ä»»åŠ¡', 'çŸ¥è¯†', 'è®°å½•'],
                color: '#8b5cf6'
            },
            supervisor: {
                name: 'ä¸»ç®¡',
                dept: 'ç®¡ç†éƒ¨é—¨',
                avatar: 'ğŸ‘”',
                tabs: ['é¦–é¡µ', 'å›¢é˜Ÿ', 'å®¡æ ¸', 'æŠ¥è¡¨'],
                color: '#ec4899'
            },
            executive: {
                name: 'é«˜é˜¶ä¸»ç®¡',
                dept: 'ç»è¥å±‚',
                avatar: 'ğŸ“ˆ',
                tabs: ['é¦–é¡µ', 'ç»è¥', 'åˆ†æ', 'å†³ç­–'],
                color: '#dc2626'
            }
        };
        
        // Role-specific dashboards
        const dashboards = {
            production: {
                stats: [
                    { label: 'ä»Šæ—¥äº§å‡º', value: '12,500', unit: 'ç‰‡', color: 'green' },
                    { label: 'è¾¾æˆç‡', value: '98.2%', unit: '', color: 'green' },
                    { label: 'å¾…å‡ºè´§', value: '3,200', unit: 'ç‰‡', color: 'yellow' }
                ],
                content: 'production'
            },
            equipment: {
                stats: [
                    { label: 'è®¾å¤‡æ€»æ•°', value: '48', unit: 'å°', color: '' },
                    { label: 'æ­£å¸¸è¿è¡Œ', value: '45', unit: 'å°', color: 'green' },
                    { label: 'å¾…ä¿å…»', value: '3', unit: 'å°', color: 'yellow' }
                ],
                content: 'equipment'
            },
            quality: {
                stats: [
                    { label: 'è‰¯ç‡', value: '99.2%', unit: '', color: 'green' },
                    { label: 'å¾…å¤„ç†', value: '5', unit: 'ä»¶', color: 'yellow' },
                    { label: 'HOLD', value: '2', unit: 'æ‰¹', color: 'red' }
                ],
                content: 'quality'
            },
            supervisor: {
                stats: [
                    { label: 'å›¢é˜Ÿäººæ•°', value: '8', unit: 'äºº', color: '' },
                    { label: 'å¾…å®¡æ ¸', value: '12', unit: 'ä»¶', color: 'yellow' },
                    { label: 'å®Œæˆç‡', value: '85%', unit: '', color: 'green' }
                ],
                content: 'supervisor'
            },
            executive: {
                stats: [
                    { label: 'æœˆè¥æ”¶', value: '2.8M', unit: '', color: 'green' },
                    { label: 'äº§èƒ½åˆ©ç”¨ç‡', value: '92%', unit: '', color: 'green' },
                    { label: 'è¾¾æˆç‡', value: '96%', unit: '', color: 'green' }
                ],
                content: 'executive'
            }
        };
        
        // ========== Data ==========
        const tasks = [
            { id: 1, name: 'ç¡®è®¤ä»Šæ—¥ç”Ÿäº§æ’é…', desc: 'æ£€æŸ¥äº§çº¿æ’é…è¾¾æˆ', priority: 'high', status: 'pending', role: 'production' },
            { id: 2, name: 'äº§èƒ½åˆ©ç”¨ç‡æ£€è®¨', desc: 'å„çº¿äº§èƒ½åˆ†æ', priority: 'medium', status: 'pending', role: 'production' },
            { id: 3, name: 'è®¾å¤‡æ—¥å¸¸ç‚¹æ£€', desc: 'å…³é”®è®¾å¤‡ç‚¹æ£€', priority: 'high', status: 'pending', role: 'equipment' },
            { id: 4, name: 'ä¿å…»è®¡åˆ’æ‰§è¡Œ', desc: 'æœ¬æœˆä¿å…»è¿›åº¦', priority: 'medium', status: 'pending', role: 'equipment' },
            { id: 5, name: 'å“è´¨å¼‚å¸¸å¤„ç†', desc: 'IQCå¼‚å¸¸ç¡®è®¤', priority: 'high', status: 'pending', role: 'quality' },
            { id: 6, name: 'HOLDå“å¤åˆ¤', desc: '2æ‰¹HOLDå“å¤åˆ¤', priority: 'high', status: 'pending', role: 'quality' },
        ];
        
        const records = [
            { date: '19', month: '02', title: 'ç”Ÿäº§æ’é…ç¡®è®¤', stats: 'è¾¾æˆç‡ 98%' },
            { date: '18', month: '02', title: 'è®¾å¤‡ä¿å…»å®Œæˆ', stats: '3å°è®¾å¤‡' },
            { date: '17', month: '02', title: 'å“è´¨å¼‚å¸¸å¤„ç†', stats: '5ä»¶å·²ç»“æ¡ˆ' },
            { date: '16', month: '02', title: 'å‘¨æŠ¥æ±‡æ€»', stats: 'å›¢é˜Ÿ8äºº' },
        ];
        
        let currentRole = 'production';
        
        // ========== Login ==========
        function updateDemoInfo() {
            const role = document.getElementById('login-role').value;
            const roleInfo = roles[role];
            document.getElementById('login-username').value = role === 'production' ? 'sc001' : role === 'equipment' ? 'eq001' : role === 'quality' ? 'qa001' : role === 'supervisor' ? 'sp001' : 'ex001';
            document.getElementById('login-password').value = '123456';
        }
        
        function handleLogin(e) {
            e.preventDefault();
            currentRole = document.getElementById('login-role').value;
            const roleInfo = roles[currentRole];
            
            localStorage.setItem('factory_user', JSON.stringify({
                role: currentRole,
                name: roleInfo.name,
                dept: roleInfo.dept
            }));
            
            showApp();
        }
        
        function logout() {
            localStorage.removeItem('factory_user');
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('app-container').classList.remove('active');
        }
        
        function showApp() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('app-container').classList.add('active');
            
            const roleInfo = roles[currentRole];
            document.getElementById('header-role').textContent = roleInfo.name;
            document.getElementById('user-name').textContent = roleInfo.name;
            document.getElementById('user-role').textContent = roleInfo.dept;
            document.getElementById('user-avatar').textContent = roleInfo.avatar;
            
            renderTabs();
            renderContent();
        }
        
        // ========== Tabs ==========
        function renderTabs() {
            const roleInfo = roles[currentRole];
            const tabsHtml = roleInfo.tabs.map((tab, idx) => 
                `<div class="tab ${idx === 0 ? 'active' : ''}" data-tab="${tab}" onclick="switchTab('${tab}')">${tab}</div>`
            ).join('');
            document.getElementById('main-tabs').innerHTML = tabsHtml;
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            const content = document.getElementById(`content-${tabName}`);
            if (content) content.style.display = 'block';
        }
        
        // ========== Content ==========
        function renderContent() {
            const roleInfo = roles[currentRole];
            const dashboard = dashboards[currentRole];
            
            let contentHtml = '';
            
            // Tab 1: é¦–é¡µ
            contentHtml += `
                <div class="tab-content active" id="content-${roleInfo.tabs[0]}">
                    <div class="stats-grid">
                        ${dashboard.stats.map(s => `
                            <div class="stat-card ${s.color ? s.color : ''}">
                                <div class="stat-value">${s.value}</div>
                                <div class="stat-label">${s.label}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${renderRoleDashboard(currentRole)}
                    
                    <div class="card">
                        <div class="card-title">ğŸ“‹ å¾…åŠä»»åŠ¡</div>
                        ${renderTaskList()}
                    </div>
                </div>
            `;
            
            // Tab 2: Role specific
            const tab2Name = roleInfo.tabs[1];
            contentHtml += `
                <div class="tab-content" id="content-${tab2Name}">
                    ${renderRoleContent(currentRole, tab2Name)}
                </div>
            `;
            
            // Tab 3: Tasks/Records
            const tab3Name = roleInfo.tabs[2];
            contentHtml += `
                <div class="tab-content" id="content-${tab3Name}">
                    ${tab3Name === 'ä»»åŠ¡' || tab3Name === 'è®°å½•' || tab3Name === 'å¼‚å¸¸' || tab3Name === 'å›¢é˜Ÿ' || tab3Name === 'åˆ†æ' ? renderTaskList() : renderRecords()}
                </div>
            `;
            
            // Tab 4: Records/Reports
            const tab4Name = roleInfo.tabs[3];
            contentHtml += `
                <div class="tab-content" id="content-${tab4Name}">
                    ${renderRecords()}
                </div>
            `;
            
            document.getElementById('tab-contents').innerHTML = contentHtml;
        }
        
        function renderRoleDashboard(role) {
            if (role === 'production') {
                return `
                    <div class="card">
                        <div class="card-title">ğŸ“Š ç”Ÿäº§æ¦‚è§ˆ</div>
                        <div class="kpi-row">
                            <div class="kpi-card">
                                <div class="kpi-value green">98.2%</div>
                                <div class="kpi-label">è¾¾æˆç‡</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value">85%</div>
                                <div class="kpi-label">äº§èƒ½åˆ©ç”¨ç‡</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value yellow">3</div>
                                <div class="kpi-label">ç¼ºæ–™é¡¹</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (role === 'equipment') {
                return `
                    <div class="card">
                        <div class="card-title">ğŸ”§ è®¾å¤‡çŠ¶æ€</div>
                        <div class="equipment-grid">
                            <div class="equip-card"><div class="equip-icon normal"><i class="ri-settings-3-line"></i></div><div class="equip-name">A-001</div><div class="equip-status">æ­£å¸¸è¿è¡Œ</div></div>
                            <div class="equip-card"><div class="equip-icon normal"><i class="ri-settings-3-line"></i></div><div class="equip-name">A-002</div><div class="equip-status">æ­£å¸¸è¿è¡Œ</div></div>
                            <div class="equip-card"><div class="equip-icon warning"><i class="ri-settings-3-line"></i></div><div class="equip-name">B-101</div><div class="equip-status">éœ€ä¿å…»</div></div>
                            <div class="equip-card"><div class="equip-icon normal"><i class="ri-settings-3-line"></i></div><div class="equip-name">C-201</div><div class="equip-status">æ­£å¸¸è¿è¡Œ</div></div>
                            <div class="equip-card"><div class="equip-icon error"><i class="ri-settings-3-line"></i></div><div class="equip-name">D-301</div><div class="equip-status">æ•…éšœ</div></div>
                            <div class="equip-card"><div class="equip-icon normal"><i class="ri-settings-3-line"></i></div><div class="equip-name">D-302</div><div class="equip-status">æ­£å¸¸è¿è¡Œ</div></div>
                        </div>
                    </div>
                `;
            } else if (role === 'quality') {
                return `
                    <div class="card">
                        <div class="card-title">âš ï¸ å“è´¨é¢„è­¦</div>
                        <div class="quality-alert">
                            <div class="quality-icon">ğŸ”´</div>
                            <div class="quality-info">
                                <div class="quality-title">HOLD: LOT#20260219-001</div>
                                <div class="quality-desc">å¤–è§‚å¼‚å¸¸ï¼Œç­‰å¾…å¤åˆ¤</div>
                            </div>
                        </div>
                        <div class="quality-alert">
                            <div class="quality-icon">ğŸŸ¡</div>
                            <div class="quality-info">
                                <div class="quality-title">IQCå¼‚å¸¸: ä¾›åº”å•†Aææ–™</div>
                                <div class="quality-desc">å°ºå¯¸è¶…è§„ï¼Œå·²å¼€ç«‹å¼‚å¸¸å•</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (role === 'supervisor') {
                return `
                    <div class="card">
                        <div class="card-title">ğŸ‘¥ å›¢é˜Ÿæ¦‚å†µ</div>
                        <div class="kpi-row">
                            <div class="kpi-card">
                                <div class="kpi-value">8</div>
                                <div class="kpi-label">å›¢é˜Ÿäººæ•°</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value green">85%</div>
                                <div class="kpi-label">ä»»åŠ¡å®Œæˆç‡</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value yellow">3</div>
                                <div class="kpi-label">å¾…å®¡æ ¸</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (role === 'executive') {
                return `
                    <div class="card">
                        <div class="card-title">ğŸ“ˆ ç»è¥æŒ‡æ ‡</div>
                        <div class="kpi-row">
                            <div class="kpi-card">
                                <div class="kpi-value green">2.8M</div>
                                <div class="kpi-label">æœˆè¥æ”¶</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value green">92%</div>
                                <div class="kpi-label">äº§èƒ½åˆ©ç”¨ç‡</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value green">99.1%</div>
                                <div class="kpi-label">è‰¯ç‡</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            return '';
        }
        
        function renderRoleContent(role, tabName) {
            if (role === 'production' && tabName === 'æ’é…') {
                return `
                    <div class="card">
                        <div class="card-title">ğŸ“… ä»Šæ—¥æ’é…</div>
                        <div style="padding: 20px; text-align: center;">
                            <div style="font-size: 32px; font-weight: 700; color: var(--success);">98.2%</div>
                            <div style="color: var(--text-light);">æ’é…è¾¾æˆç‡</div>
                        </div>
                        <table class="data-table">
                            <tr><th>äº§çº¿</th><th>è®¡åˆ’</th><th>å®é™…</th><th>è¾¾æˆ</th></tr>
                            <tr><td>L1</td><td>5000</td><td>4920</td><td style="color:var(--success)">98.4%</td></tr>
                            <tr><td>L2</td><td>4500</td><td>4410</td><td style="color:var(--success)">98.0%</td></tr>
                            <tr><td>L3</td><td>3000</td><td>3170</td><td style="color:var(--success)">105.7%</td></tr>
                        </table>
                    </div>
                `;
            } else if (role === 'equipment' && tabName === 'è®¾å¤‡') {
                return renderRoleDashboard('equipment');
            } else if (role === 'quality' && tabName === 'å“è´¨') {
                return `
                    <div class="card">
                        <div class="card-title">ğŸ“Š å“è´¨æŒ‡æ ‡</div>
                        <div class="kpi-row">
                            <div class="kpi-card">
                                <div class="kpi-value green">99.2%</div>
                                <div class="kpi-label">è‰¯ç‡</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value yellow">0.8%</div>
                                <div class="kpi-label">ä¸è‰¯ç‡</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value red">2</div>
                                <div class="kpi-label">HOLDæ‰¹</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            return '<div class="card"><div class="card-title">' + tabName + '</div><div style="padding: 40px; text-align: center; color: var(--text-light);">å†…å®¹å¼€å‘ä¸­...</div></div>';
        }
        
        function renderTaskList() {
            const roleTasks = tasks.filter(t => !t.role || t.role === currentRole || currentRole === 'executive');
            return roleTasks.map(task => `
                <div class="task-item">
                    <div class="task-priority ${task.priority}"></div>
                    <div class="task-info">
                        <div class="task-name">${task.name}</div>
                        <div class="task-meta">${task.desc}</div>
                    </div>
                    <span class="task-tag">${task.status === 'pending' ? 'å¾…å¤„ç†' : 'å·²å®Œæˆ'}</span>
                </div>
            `).join('');
        }
        
        function renderRecords() {
            return records.map(r => `
                <div class="record-item">
                    <div class="record-date">
                        <div class="record-day">${r.date}</div>
                        <div class="record-month">${r.month}æœˆ</div>
                    </div>
                    <div class="record-info">
                        <div class="record-title">${r.title}</div>
                        <div class="record-stats">${r.stats}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // ========== AI Planning ==========
        function openAIPlanning() {
            document.getElementById('ai-modal').classList.add('active');
            document.getElementById('ai-result').style.display = 'none';
            document.getElementById('work-desc').value = '';
        }
        
        function closeModal() {
            document.getElementById('ai-modal').classList.remove('active');
        }
        
        function runAIPlanning() {
            const workDesc = document.getElementById('work-desc').value.trim();
            if (!workDesc) {
                alert('è¯·æè¿°æ‚¨çš„å·¥ä½œå†…å®¹');
                return;
            }
            
            // Simulate AI analysis
            const resultDiv = document.getElementById('ai-result');
            const tasksDiv = document.getElementById('ai-tasks');
            resultDiv.style.display = 'block';
            tasksDiv.innerHTML = '<div style="text-align: center; padding: 20px;">ğŸ¤– AIåˆ†æä¸­...</div>';
            
            setTimeout(() => {
                const generatedTasks = generateAITasks(workDesc, currentRole);
                tasksDiv.innerHTML = generatedTasks.map(t => `
                    <div class="task-item" style="background: var(--bg); margin-bottom: 8px; border-radius: 8px;">
                        <div class="task-priority ${t.priority}"></div>
                        <div class="task-info">
                            <div class="task-name">${t.name}</div>
                            <div class="task-meta">${t.desc}</div>
                        </div>
                    </div>
                `).join('');
            }, 2000);
        }
        
        function generateAITasks(workDesc, role) {
            // AI generates tasks based on role and work description
            const baseTasks = {
                production: [
                    { name: 'ç”Ÿäº§æ’é…ç¡®è®¤', desc: 'ç¡®è®¤å½“æ—¥æ’é…è®¡åˆ’', priority: 'high' },
                    { name: 'äº§èƒ½åˆ©ç”¨ç‡åˆ†æ', desc: 'åˆ†æå„äº§çº¿äº§èƒ½', priority: 'medium' },
                    { name: 'ç¼ºæ–™é—®é¢˜å¤„ç†', desc: 'è·Ÿè¿›ç¼ºæ–™è¿›åº¦', priority: 'high' },
                    { name: 'å‡ºè´§åè°ƒ', desc: 'åè°ƒå‡ºè´§äº‹å®œ', priority: 'medium' }
                ],
                equipment: [
                    { name: 'è®¾å¤‡ç‚¹æ£€', desc: 'å…³é”®è®¾å¤‡æ—¥å¸¸ç‚¹æ£€', priority: 'high' },
                    { name: 'ä¿å…»è®¡åˆ’ç¡®è®¤', desc: 'ç¡®è®¤æœ¬æœˆä¿å…»è¿›åº¦', priority: 'medium' },
                    { name: 'æ•…éšœå¤„ç†', desc: 'å¤„ç†è®¾å¤‡æ•…éšœ', priority: 'high' },
                    { name: 'å¤‡ä»¶ç®¡ç†', desc: 'æ£€æŸ¥å¤‡ä»¶åº“å­˜', priority: 'low' }
                ],
                quality: [
                    { name: 'IQCæ£€éªŒ', desc: 'æ¥æ–™æ£€éªŒç¡®è®¤', priority: 'high' },
                    { name: 'å¼‚å¸¸å¤„ç†', desc: 'å¤„ç†å“è´¨å¼‚å¸¸', priority: 'high' },
                    { name: 'HOLDå¤åˆ¤', desc: 'HOLDå“å¤åˆ¤ç¡®è®¤', priority: 'high' },
                    { name: 'è‰¯ç‡åˆ†æ', desc: 'åˆ†æè‰¯ç‡æ•°æ®', priority: 'medium' }
                ]
            };
            
            return baseTasks[role] || baseTasks.production;
        }
        
        // ========== Init ==========
        window.onload = function() {
            const user = localStorage.getItem('factory_user');
            if (user) {
                const userData = JSON.parse(user);
                currentRole = userData.role;
                showApp();
            } else {
                updateDemoInfo();
            }
        };
    </script>
</body>
</html>
