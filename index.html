<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FactoryAI æ™ºå·¥åŠ©æ‰‹</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a5f;
            --primary-light: #2d5a8a;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }
        
        /* Login Page */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            padding: 20px;
        }
        
        .login-box {
            background: var(--card);
            border-radius: 16px;
            padding: 40px 30px;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo h1 {
            font-size: 28px;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        .login-logo p {
            color: var(--text-light);
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text);
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            border-color: var(--primary);
        }
        
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        /* Main App */
        .app-container {
            display: none;
            min-height: 100vh;
        }
        
        .app-container.active {
            display: block;
        }
        
        /* Header */
        .header {
            background: var(--primary);
            color: white;
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .header-user {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .header-user .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 58px;
            z-index: 99;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            min-width: 70px;
            padding: 14px 10px;
            text-align: center;
            font-size: 12px;
            color: var(--text-light);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            font-weight: 600;
        }
        
        .tab i {
            display: block;
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        /* Content */
        .content {
            padding: 16px;
            display: none;
        }
        
        .content.active {
            display: block;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .stat-card {
            background: var(--card);
            padding: 16px 12px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 4px;
        }
        
        .stat-card.warning .stat-value {
            color: var(--warning);
        }
        
        .stat-card.danger .stat-value {
            color: var(--danger);
        }
        
        .stat-card.success .stat-value {
            color: var(--success);
        }
        
        /* Dashboard Cards */
        .dashboard-section {
            margin-bottom: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }
        
        .section-more {
            font-size: 13px;
            color: var(--primary);
            cursor: pointer;
        }
        
        /* Cards */
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .card-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Equipment Grid */
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .equipment-item {
            background: var(--bg);
            border-radius: 10px;
            padding: 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .equipment-item:active {
            transform: scale(0.95);
        }
        
        .equipment-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 22px;
        }
        
        .equipment-icon.normal {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .equipment-icon.warning {
            background: #fef3c7;
            color: #d97706;
        }
        
        .equipment-icon.error {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .equipment-name {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .equipment-status {
            font-size: 11px;
            color: var(--text-light);
        }
        
        /* Task List */
        .task-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }
        
        .task-item:last-child {
            border-bottom: none;
        }
        
        .task-item:active {
            background: var(--bg);
            margin: 0 -16px;
            padding-left: 16px;
            padding-right: 16px;
        }
        
        .task-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border);
            border-radius: 6px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .task-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-name {
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .task-meta {
            font-size: 12px;
            color: var(--text-light);
        }
        
        .task-tag {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--bg);
            color: var(--text-light);
        }
        
        .task-tag.daily {
            background: #dbeafe;
            color: #2563eb;
        }
        
        .task-tag.weekly {
            background: #fce7f3;
            color: #db2777;
        }
        
        .task-tag.monthly {
            background: #fef3c7;
            color: #d97706;
        }
        
        /* Knowledge List */
        .knowledge-item {
            display: flex;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }
        
        .knowledge-item:last-child {
            border-bottom: none;
        }
        
        .knowledge-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 18px;
            color: var(--primary);
        }
        
        .knowledge-info {
            flex: 1;
        }
        
        .knowledge-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .knowledge-meta {
            font-size: 12px;
            color: var(--text-light);
        }
        
        /* Admin Panel */
        .admin-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }
        
        .admin-tab {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            white-space: nowrap;
            background: var(--bg);
            color: var(--text-light);
            cursor: pointer;
            border: none;
        }
        
        .admin-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .data-table th {
            font-weight: 600;
            color: var(--text-light);
            font-size: 12px;
        }
        
        .data-table tr:active {
            background: var(--bg);
        }
        
        .action-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            margin-right: 4px;
        }
        
        .action-btn.edit {
            background: #dbeafe;
            color: #2563eb;
        }
        
        .action-btn.delete {
            background: #fee2e2;
            color: #dc2626;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: var(--card);
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }
        
        .modal-footer .btn {
            flex: 1;
        }
        
        .btn-secondary {
            background: var(--bg);
            color: var(--text);
        }
        
        /* Chat */
        .chat-container {
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 16px;
        }
        
        .message {
            display: flex;
            margin-bottom: 16px;
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .message.user .message-avatar {
            background: var(--primary);
            color: white;
        }
        
        .message.ai .message-avatar {
            background: var(--success);
            color: white;
        }
        
        .message-content {
            max-width: 75%;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            margin: 0 10px;
        }
        
        .message.user .message-content {
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .message.ai .message-content {
            background: var(--card);
            border: 1px solid var(--border);
            border-bottom-left-radius: 4px;
        }
        
        .chat-input {
            display: flex;
            gap: 10px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 24px;
            font-size: 14px;
            outline: none;
        }
        
        .chat-input input:focus {
            border-color: var(--primary);
        }
        
        .chat-input button {
            width: 44px;
            height: 44px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            cursor: pointer;
        }
        
        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }
        
        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="login-page">
        <div class="login-box">
            <div class="login-logo">
                <h1>ğŸ­ FactoryAI</h1>
                <p>æ™ºå·¥åŠ©æ‰‹ - è®©å·¥ä½œæ›´æ™ºèƒ½</p>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·å</label>
                    <input type="text" class="form-input" id="login-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" class="form-input" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <button type="submit" class="btn btn-primary">ç™»å½•</button>
            </form>
            <p style="text-align: center; margin-top: 20px; font-size: 13px; color: var(--text-light);">
                æ¼”ç¤ºè´¦å·ï¼šadmin / admin123
            </p>
        </div>
    </div>
    
    <!-- Main App -->
    <div class="app-container" id="app-container">
        <!-- Header -->
        <div class="header">
            <div class="header-title">ğŸ­ FactoryAI æ™ºå·¥åŠ©æ‰‹</div>
            <div class="header-user">
                <div class="avatar">ğŸ‘¤</div>
                <span id="current-user">ç‹å·¥ç¨‹å¸ˆ</span>
                <button class="logout-btn" onclick="logout()">é€€å‡º</button>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">
                <i class="ri-dashboard-line"></i>
                é¦–é¡µ
            </div>
            <div class="tab" data-tab="equipment">
                <i class="ri-settings-3-line"></i>
                è®¾å¤‡
            </div>
            <div class="tab" data-tab="tasks">
                <i class="ri-task-line"></i>
                ä»»åŠ¡
            </div>
            <div class="tab" data-tab="knowledge">
                <i class="ri-book-2-line"></i>
                çŸ¥è¯†åº“
            </div>
            <div class="tab" data-tab="admin">
                <i class="ri-admin-line"></i>
                ç®¡ç†
            </div>
        </div>
        
        <!-- Dashboard -->
        <div class="content active" id="dashboard">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-today">6</div>
                    <div class="stat-label">ä»Šæ—¥ä»»åŠ¡</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value" id="stat-done">4</div>
                    <div class="stat-label">å·²å®Œæˆ</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-value" id="stat-pending">2</div>
                    <div class="stat-label">å¾…å®Œæˆ</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-value" id="stat-alert">2</div>
                    <div class="stat-label">å‘Šè­¦</div>
                </div>
            </div>
            
            <!-- Today's Tasks -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="section-title">ğŸ“‹ ä»Šæ—¥ä»»åŠ¡</span>
                    <span class="section-more" onclick="switchTab('tasks')">æ›´å¤š ></span>
                </div>
                <div class="card" id="today-tasks-list">
                    <!-- Tasks will be rendered here -->
                </div>
            </div>
            
            <!-- Equipment Status -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="section-title">ğŸ“Š è®¾å¤‡çŠ¶æ€</span>
                    <span class="section-more" onclick="switchTab('equipment')">æ›´å¤š ></span>
                </div>
                <div class="card">
                    <div class="equipment-grid" id="equipment-grid">
                        <!-- Equipment will be rendered here -->
                    </div>
                </div>
            </div>
            
            <!-- Alerts -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="section-title">âš ï¸ å‘Šè­¦æé†’</span>
                </div>
                <div class="card" id="alerts-list">
                    <!-- Alerts will be rendered here -->
                </div>
            </div>
            
            <!-- Knowledge -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="section-title">ğŸ“š çŸ¥è¯†æ¨è</span>
                    <span class="section-more" onclick="switchTab('knowledge')">æ›´å¤š ></span>
                </div>
                <div class="card" id="knowledge-list">
                    <!-- Knowledge will be rendered here -->
                </div>
            </div>
        </div>
        
        <!-- Equipment -->
        <div class="content" id="equipment">
            <div class="card">
                <div class="card-title">ğŸ” è®¾å¤‡æœç´¢</div>
                <input type="text" class="form-input" placeholder="æœç´¢è®¾å¤‡ç¼–å·/åç§°..." oninput="filterEquipment(this.value)">
            </div>
            <div class="card">
                <div class="equipment-grid" id="equipment-full-list">
                    <!-- Full equipment list -->
                </div>
            </div>
        </div>
        
        <!-- Tasks -->
        <div class="content" id="tasks">
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="filterTasks('all', this)">å…¨éƒ¨</button>
                <button class="admin-tab" onclick="filterTasks('daily', this)">æ—¥ä»»åŠ¡</button>
                <button class="admin-tab" onclick="filterTasks('weekly', this)">å‘¨ä»»åŠ¡</button>
                <button class="admin-tab" onclick="filterTasks('monthly', this)">æœˆä»»åŠ¡</button>
            </div>
            <div class="card" id="task-full-list">
                <!-- Full task list -->
            </div>
        </div>
        
        <!-- Knowledge -->
        <div class="content" id="knowledge">
            <div class="card">
                <div class="card-title">ğŸ” çŸ¥è¯†æœç´¢</div>
                <input type="text" class="form-input" placeholder="æœç´¢æ–‡æ¡£/é—®é¢˜...">
            </div>
            <div class="card" id="knowledge-full-list">
                <!-- Knowledge list -->
            </div>
            
            <!-- AI Chat -->
            <div class="card">
                <div class="card-title">ğŸ¤– AI æ™ºèƒ½é—®ç­”</div>
                <div class="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <div class="message ai">
                            <div class="message-avatar">ğŸ¤–</div>
                            <div class="message-content">
                                ä½ å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ ï¼š<br><br>
                                ğŸ“– è§£ç­”è®¾å¤‡æ“ä½œé—®é¢˜<br>
                                ğŸ”§ æ•…éšœè¯Šæ–­åˆ†æ<br>
                                ğŸ“‹ ç”Ÿæˆå·¡æ£€æŠ¥å‘Š<br>
                                ğŸ“š çŸ¥è¯†åº“é—®ç­”<br><br>
                                æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ
                            </div>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" placeholder="è¾“å…¥é—®é¢˜..." onkeypress="handleChatKeypress(event)">
                        <button onclick="sendChat()"><i class="ri-send-plane-fill"></i></button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin -->
        <div class="content" id="admin">
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="filterAdmin('users', this)">ç”¨æˆ·ç®¡ç†</button>
                <button class="admin-tab" onclick="filterAdmin('equipment', this)">è®¾å¤‡ç®¡ç†</button>
                <button class="admin-tab" onclick="filterAdmin('tasks', this)">ä»»åŠ¡ç®¡ç†</button>
            </div>
            <div class="card" id="admin-content">
                <!-- Admin content -->
            </div>
        </div>
    </div>
    
    <!-- Modal -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">æ ‡é¢˜</div>
                <div class="modal-close" onclick="closeModal()">
                    <i class="ri-close-line"></i>
                </div>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Content -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="modal-confirm">ç¡®å®š</button>
            </div>
        </div>
    </div>
    
    <script>
        // ========== Data ==========
        const users = [
            { id: 1, username: 'admin', name: 'ç®¡ç†å‘˜', role: 'admin', dept: 'æŠ€æœ¯éƒ¨' },
            { id: 2, username: 'wang', name: 'ç‹å·¥ç¨‹å¸ˆ', role: 'engineer', dept: 'è®¾å¤‡ç§‘' },
            { id: 3, username: 'li', name: 'æå·¥ç¨‹å¸ˆ', role: 'engineer', dept: 'è®¾å¤‡ç§‘' },
        ];
        
        const equipment = [
            { id: 1, code: 'A-001', name: 'ç©ºå‹æœº#1', category: 'ç©ºå‹æœº', status: 'normal', location: 'AåŒº', temp: 72 },
            { id: 2, code: 'A-002', name: 'ç©ºå‹æœº#2', category: 'ç©ºå‹æœº', status: 'warning', location: 'AåŒº', temp: 85 },
            { id: 3, code: 'B-101', name: 'å‚¨æ°”ç½#1', category: 'å‚¨ç½', status: 'normal', location: 'BåŒº', pressure: 0.75 },
            { id: 4, code: 'B-102', name: 'å‚¨æ°”ç½#2', category: 'å‚¨ç½', status: 'error', location: 'BåŒº', pressure: 0.92 },
            { id: 5, code: 'C-201', name: 'å†·å´å¡”#1', category: 'å†·å´', status: 'normal', location: 'CåŒº', temp: 28 },
            { id: 6, code: 'C-202', name: 'å†·å´å¡”#2', category: 'å†·å´', status: 'normal', location: 'CåŒº', temp: 30 },
            { id: 7, code: 'D-301', name: 'æ°´æ³µ#1', category: 'æ³µ', status: 'normal', location: 'DåŒº', flow: 120 },
            { id: 8, code: 'D-302', name: 'æ°´æ³µ#2', category: 'æ³µ', status: 'warning', location: 'DåŒº', flow: 95 },
        ];
        
        const tasks = [
            { id: 1, name: '8:00 ç©ºå‹æœºå·¡æ£€', desc: 'AåŒºç©ºå‹æœºè¿è¡ŒçŠ¶æ€æ£€æŸ¥', time: '08:00', done: true, type: 'daily' },
            { id: 2, name: '9:30 å‚¨æ°”ç½æ£€æŸ¥', desc: 'BåŒºå‚¨æ°”ç½å‹åŠ›è®°å½•', time: '09:30', done: true, type: 'daily' },
            { id: 3, name: '10:00 å†·å´å¡”æ¸©åº¦', desc: 'CåŒºå†·å´å¡”æ¸©åº¦æ£€æµ‹', time: '10:00', done: false, type: 'daily' },
            { id: 4, name: '11:00 æ°´æ³µè¿è¡Œæ£€æµ‹', desc: 'DåŒºæ°´æ³µæµé‡æ£€æµ‹', time: '11:00', done: false, type: 'daily' },
            { id: 5, name: '14:00 è®¾å¤‡å‘¨æ£€', desc: 'æœ¬å‘¨é‡ç‚¹è®¾å¤‡æ£€æŸ¥', time: '14:00', done: false, type: 'weekly' },
            { id: 6, name: '16:00 å·¡æ£€æ€»ç»“', desc: 'ç”Ÿæˆå½“æ—¥å·¡æ£€æŠ¥å‘Š', time: '16:00', done: false, type: 'daily' },
            { id: 7, name: 'æœˆåº¦è®¾å¤‡ä¿å…»', desc: 'é‡ç‚¹è®¾å¤‡æœˆåº¦ä¿å…»', time: '15æ—¥', done: false, type: 'monthly' },
        ];
        
        const knowledge = [
            { id: 1, title: 'ç©ºå‹æœºæ“ä½œè§„ç¨‹', category: 'è§„ç¨‹', views: 125 },
            { id: 2, title: 'å‚¨æ°”ç½å®‰å…¨æ£€æŸ¥è¦ç‚¹', category: 'å®‰å…¨', views: 98 },
            { id: 3, title: 'å†·å´å¡”ç»´æŠ¤ä¿å…»æ‰‹å†Œ', category: 'ä¿å…»', views: 86 },
            { id: 4, title: 'å¸¸è§æ•…éšœä»£ç è§£æ', category: 'æ•…éšœ', views: 156 },
            { id: 5, title: 'è®¾å¤‡æ¶¦æ»‘å‘¨æœŸè¡¨', category: 'ä¿å…»', views: 72 },
        ];
        
        const alerts = [
            { id: 1, equipment: 'B-102', message: 'å‹åŠ›è¶…è¿‡é˜ˆå€¼0.92MPa', level: 'danger', time: '10:30' },
            { id: 2, equipment: 'A-002', message: 'æ¸©åº¦åé«˜85â„ƒ', level: 'warning', time: '09:45' },
        ];
        
        // ========== Auth ==========
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            if (username === 'admin' && password === 'admin123') {
                localStorage.setItem('factory_user', JSON.stringify(users[0]));
                showApp();
            } else if (username === 'wang' && password === 'wang123') {
                localStorage.setItem('factory_user', JSON.stringify(users[1]));
                showApp();
            } else {
                alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
            }
        }
        
        function logout() {
            localStorage.removeItem('factory_user');
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('app-container').classList.remove('active');
        }
        
        function showApp() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('app-container').classList.add('active');
            
            const user = JSON.parse(localStorage.getItem('factory_user'));
            document.getElementById('current-user').textContent = user.name;
            
            renderDashboard();
            renderEquipment();
            renderTasks();
            renderKnowledge();
            renderAdmin('users');
        }
        
        // ========== Tabs ==========
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => switchTab(tab.dataset.tab));
        });
        
        // ========== Dashboard ==========
        function renderDashboard() {
            // Stats
            const todayTasks = tasks.filter(t => t.type === 'daily');
            const doneTasks = todayTasks.filter(t => t.done).length;
            document.getElementById('stat-today').textContent = todayTasks.length;
            document.getElementById('stat-done').textContent = doneTasks;
            document.getElementById('stat-pending').textContent = todayTasks.length - doneTasks;
            document.getElementById('stat-alert').textContent = alerts.length;
            
            // Today's tasks
            const tasksList = document.getElementById('today-tasks-list');
            tasksList.innerHTML = tasks.filter(t => t.type === 'daily').slice(0, 4).map(task => `
                <div class="task-item" onclick="showTaskDetail(${task.id})">
                    <div class="task-checkbox ${task.done ? 'checked' : ''}">
                        ${task.done ? '<i class="ri-check-line"></i>' : ''}
                    </div>
                    <div class="task-info">
                        <div class="task-name">${task.name}</div>
                        <div class="task-meta">${task.desc} Â· ${task.time}</div>
                    </div>
                </div>
            `).join('');
            
            // Equipment
            const equipGrid = document.getElementById('equipment-grid');
            equipGrid.innerHTML = equipment.slice(0, 4).map(e => `
                <div class="equipment-item" onclick="showEquipmentDetail(${e.id})">
                    <div class="equipment-icon ${e.status}">
                        <i class="ri-settings-3-line"></i>
                    </div>
                    <div class="equipment-name">${e.code}</div>
                    <div class="equipment-status">${e.name}</div>
                </div>
            `).join('');
            
            // Alerts
            const alertsList = document.getElementById('alerts-list');
            alertsList.innerHTML = alerts.map(a => `
                <div class="task-item">
                    <div class="task-info">
                        <div class="task-name" style="color: ${a.level === 'danger' ? 'var(--danger)' : 'var(--warning)'}">
                            ${a.level === 'danger' ? 'ğŸ”´' : 'âš ï¸'} ${a.equipment}
                        </div>
                        <div class="task-meta">${a.message} Â· ${a.time}</div>
                    </div>
                </div>
            `).join('');
            
            // Knowledge
            const knowList = document.getElementById('knowledge-list');
            knowList.innerHTML = knowledge.slice(0, 3).map(k => `
                <div class="knowledge-item">
                    <div class="knowledge-icon"><i class="ri-file-text-line"></i></div>
                    <div class="knowledge-info">
                        <div class="knowledge-title">${k.title}</div>
                        <div class="knowledge-meta">${k.category} Â· ${k.views}æ¬¡æµè§ˆ</div>
                    </div>
                </div>
            `).join('');
        }
        
        // ========== Equipment ==========
        function renderEquipment() {
            const list = document.getElementById('equipment-full-list');
            list.innerHTML = equipment.map(e => `
                <div class="equipment-item" onclick="showEquipmentDetail(${e.id})">
                    <div class="equipment-icon ${e.status}">
                        <i class="ri-settings-3-line"></i>
                    </div>
                    <div class="equipment-name">${e.code}</div>
                    <div class="equipment-status">${e.name}</div>
                </div>
            `).join('');
        }
        
        function filterEquipment(keyword) {
            const filtered = equipment.filter(e => 
                e.code.includes(keyword) || e.name.includes(keyword)
            );
            const list = document.getElementById('equipment-full-list');
            list.innerHTML = filtered.map(e => `
                <div class="equipment-item" onclick="showEquipmentDetail(${e.id})">
                    <div class="equipment-icon ${e.status}">
                        <i class="ri-settings-3-line"></i>
                    </div>
                    <div class="equipment-name">${e.code}</div>
                    <div class="equipment-status">${e.name}</div>
                </div>
            `).join('');
        }
        
        function showEquipmentDetail(id) {
            const e = equipment.find(item => item.id === id);
            if (!e) return;
            
            document.getElementById('modal-title').textContent = e.name;
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label class="form-label">è®¾å¤‡ç¼–å·</label>
                    <div style="padding: 12px; background: var(--bg); border-radius: 8px;">${e.code}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">è®¾å¤‡åç§°</label>
                    <div style="padding: 12px; background: var(--bg); border-radius: 8px;">${e.name}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">è®¾å¤‡åˆ†ç±»</label>
                    <div style="padding: 12px; background: var(--bg); border-radius: 8px;">${e.category}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">å®‰è£…ä½ç½®</label>
                    <div style="padding: 12px; background: var(--bg); border-radius: 8px;">${e.location}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">è¿è¡ŒçŠ¶æ€</label>
                    <div style="padding: 12px; background: var(--bg); border-radius: 8px; color: ${e.status === 'normal' ? 'var(--success)' : e.status === 'warning' ? 'var(--warning)' : 'var(--danger)'}">
                        ${e.status === 'normal' ? 'âœ… æ­£å¸¸' : e.status === 'warning' ? 'âš ï¸ è­¦å‘Š' : 'âŒ æ•…éšœ'}
                    </div>
                </div>
            `;
            document.getElementById('modal').classList.add('active');
            document.getElementById('modal-confirm').style.display = 'none';
        }
        
        // ========== Tasks ==========
        let currentTaskFilter = 'all';
        
        function renderTasks() {
            renderTaskList(currentTaskFilter);
        }
        
        function filterTasks(type, btn) {
            document.querySelectorAll('#tasks .admin-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            currentTaskFilter = type;
            renderTaskList(type);
        }
        
        function renderTaskList(type) {
            const filtered = type === 'all' ? tasks : tasks.filter(t => t.type === type);
            const list = document.getElementById('task-full-list');
            list.innerHTML = filtered.map(task => `
                <div class="task-item" onclick="showTaskDetail(${task.id})">
                    <div class="task-checkbox ${task.done ? 'checked' : ''}">
                        ${task.done ? '<i class="ri-check-line"></i>' : ''}
                    </div>
                    <div class="task-info">
                        <div class="task-name">${task.name}</div>
                        <div class="task-meta">${task.desc}</div>
                    </div>
                    <span class="task-tag ${task.type}">${task.type === 'daily' ? 'æ—¥' : task.type === 'weekly' ? 'å‘¨' : 'æœˆ'}</span>
                </div>
            `).join('');
        }
        
        function showTaskDetail(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            document.getElementById('modal-title').textContent = task.name;
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label class="form-label">ä»»åŠ¡æè¿°</label>
                    <div style="padding: 12px; background: var(--bg); border-radius: 8px;">${task.desc}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">è®¡åˆ’æ—¶é—´</label>
                    <div style="padding: 12px; background: var(--bg); border-radius: 8px;">${task.time}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">ä»»åŠ¡ç±»å‹</label>
                    <div style="padding: 12px; background: var(--bg); border-radius: 8px;">
                        <span class="task-tag ${task.type}">${task.type === 'daily' ? 'æ—¥ä»»åŠ¡' : task.type === 'weekly' ? 'å‘¨ä»»åŠ¡' : 'æœˆä»»åŠ¡'}</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">çŠ¶æ€</label>
                    <div style="padding: 12px; background: var(--bg); border-radius: 8px; color: ${task.done ? 'var(--success)' : 'var(--warning)'}">
                        ${task.done ? 'âœ… å·²å®Œæˆ' : 'â³ å¾…å®Œæˆ'}
                    </div>
                </div>
            `;
            document.getElementById('modal').classList.add('active');
            document.getElementById('modal-confirm').textContent = task.done ? 'æ ‡è®°ä¸ºæœªå®Œæˆ' : 'æ ‡è®°ä¸ºå®Œæˆ';
            document.getElementById('modal-confirm').style.display = 'block';
            document.getElementById('modal-confirm').onclick = function() {
                task.done = !task.done;
                renderTasks();
                renderDashboard();
                closeModal();
            };
        }
        
        // ========== Knowledge ==========
        function renderKnowledge() {
            const list = document.getElementById('knowledge-full-list');
            list.innerHTML = knowledge.map(k => `
                <div class="knowledge-item">
                    <div class="knowledge-icon"><i class="ri-file-text-line"></i></div>
                    <div class="knowledge-info">
                        <div class="knowledge-title">${k.title}</div>
                        <div class="knowledge-meta">${k.category} Â· ${k.views}æ¬¡æµè§ˆ</div>
                    </div>
                </div>
            `).join('');
        }
        
        // ========== Chat ==========
        function handleChatKeypress(e) {
            if (e.key === 'Enter') sendChat();
        }
        
        function sendChat() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;
            
            const messages = document.getElementById('chat-messages');
            messages.innerHTML += `
                <div class="message user">
                    <div class="message-avatar">ğŸ‘¤</div>
                    <div class="message-content">${text}</div>
                </div>
            `;
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                let response = '';
                if (text.includes('æ•…éšœ') || text.includes('å¼‚å¸¸')) {
                    response = 'æ ¹æ®æ‚¨æè¿°çš„é—®é¢˜ï¼Œå¯èƒ½çš„åŸå› åŒ…æ‹¬ï¼š\n\n1. è®¾å¤‡è¿‡è½½è¿è¡Œ\n2. ä¼ æ„Ÿå™¨æ•…éšœ\n3. æ§åˆ¶ç³»ç»Ÿå¼‚å¸¸\n\nå»ºè®®æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š\nâ‘  æ£€æŸ¥è®¾å¤‡è¿è¡Œå‚æ•°\nâ‘¡ æŸ¥çœ‹æ˜¯å¦æœ‰å‘Šè­¦è®°å½•\nâ‘¢ å¿…è¦æ—¶è”ç³»è®¾å¤‡å‚å®¶';
                } else if (text.includes('ä¿å…»') || text.includes('ç»´æŠ¤')) {
                    response = 'è®¾å¤‡ä¿å…»å»ºè®®ï¼š\n\nâ€¢ ç©ºå‹æœºï¼šæ¯2000å°æ—¶æ›´æ¢æ¶¦æ»‘æ²¹\nâ€¢ å†·å´å¡”ï¼šæ¯æœˆæ¸…æ´—å¡«æ–™\nâ€¢ æ°´æ³µï¼šæ¯å­£åº¦æ£€æŸ¥å¯†å°ä»¶\n\nå…·ä½“ä¿å…»å‘¨æœŸå¯å‚è€ƒè®¾å¤‡æ‰‹å†Œã€‚';
                } else {
                    response = 'æ”¶åˆ°æ‚¨çš„é—®é¢˜ï¼\n\næˆ‘å¯ä»¥å¸®æ‚¨ï¼š\nğŸ“– è§£ç­”è®¾å¤‡æ“ä½œé—®é¢˜\nğŸ”§ æ•…éšœè¯Šæ–­åˆ†æ\nğŸ“‹ ç”Ÿæˆå·¡æ£€æŠ¥å‘Š\n\nè¯·è¯¦ç»†æè¿°æ‚¨çš„é—®é¢˜ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©æ‚¨ã€‚';
                }
                
                messages.innerHTML += `
                    <div class="message ai">
                        <div class="message-avatar">ğŸ¤–</div>
                        <div class="message-content">${response}</div>
                    </div>
                `;
                messages.scrollTop = messages.scrollHeight;
            }, 1500);
            
            messages.scrollTop = messages.scrollHeight;
        }
        
        // ========== Admin ==========
        let currentAdminFilter = 'users';
        
        function filterAdmin(type, btn) {
            document.querySelectorAll('#admin .admin-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            currentAdminFilter = type;
            renderAdmin(type);
        }
        
        function renderAdmin(type) {
            const content = document.getElementById('admin-content');
            
            if (type === 'users') {
                content.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ç”¨æˆ·å</th>
                                <th>å§“å</th>
                                <th>éƒ¨é—¨</th>
                                <th>è§’è‰²</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${users.map(u => `
                                <tr>
                                    <td>${u.id}</td>
                                    <td>${u.username}</td>
                                    <td>${u.name}</td>
                                    <td>${u.dept}</td>
                                    <td>${u.role === 'admin' ? 'ç®¡ç†å‘˜' : 'å·¥ç¨‹å¸ˆ'}</td>
                                    <td>
                                        <button class="action-btn edit">ç¼–è¾‘</button>
                                        <button class="action-btn delete">åˆ é™¤</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else if (type === 'equipment') {
                content.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç¼–å·</th>
                                <th>åç§°</th>
                                <th>åˆ†ç±»</th>
                                <th>ä½ç½®</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${equipment.map(e => `
                                <tr>
                                    <td>${e.code}</td>
                                    <td>${e.name}</td>
                                    <td>${e.category}</td>
                                    <td>${e.location}</td>
                                    <td style="color: ${e.status === 'normal' ? 'var(--success)' : e.status === 'warning' ? 'var(--warning)' : 'var(--danger)'}">
                                        ${e.status === 'normal' ? 'æ­£å¸¸' : e.status === 'warning' ? 'è­¦å‘Š' : 'æ•…éšœ'}
                                    </td>
                                    <td>
                                        <button class="action-btn edit">ç¼–è¾‘</button>
                                        <button class="action-btn delete">åˆ é™¤</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else if (type === 'tasks') {
                content.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ä»»åŠ¡åç§°</th>
                                <th>ç±»å‹</th>
                                <th>æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tasks.map(t => `
                                <tr>
                                    <td>${t.id}</td>
                                    <td>${t.name}</td>
                                    <td>${t.type === 'daily' ? 'æ—¥' : t.type === 'weekly' ? 'å‘¨' : 'æœˆ'}</td>
                                    <td>${t.time}</td>
                                    <td style="color: ${t.done ? 'var(--success)' : 'var(--warning)'}">
                                        ${t.done ? 'å·²å®Œæˆ' : 'å¾…å®Œæˆ'}
                                    </td>
                                    <td>
                                        <button class="action-btn edit">ç¼–è¾‘</button>
                                        <button class="action-btn delete">åˆ é™¤</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }
        
        // ========== Modal ==========
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }
        
        // ========== Init ==========
        window.onload = function() {
            const user = localStorage.getItem('factory_user');
            if (user) {
                showApp();
            }
        };
    </script>
</body>
</html>
