<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å·¥å‚å·¥ç¨‹å¸ˆåŠ©æ‰‹</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a5f;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            padding-bottom: 80px;
        }
        
        /* Header */
        .header {
            background: var(--primary);
            color: white;
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .header .time {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 60px;
            z-index: 99;
        }
        
        .tab {
            flex: 1;
            padding: 14px;
            text-align: center;
            font-size: 13px;
            color: var(--text-light);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            font-weight: 600;
        }
        
        .tab i {
            display: block;
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        /* Content */
        .content {
            padding: 16px;
            display: none;
        }
        
        .content.active {
            display: block;
        }
        
        /* Task Detail Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.2s;
        }
        
        .modal-overlay.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card);
            border-radius: 20px 20px 0 0;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--card);
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        /* Cards */
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .card-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #d97706;
        }
        
        .status-done {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .status-processing {
            background: #dbeafe;
            color: #2563eb;
        }
        
        /* Task List */
        .task-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }
        
        .task-item:last-child {
            border-bottom: none;
        }
        
        .task-item:active {
            background: var(--bg);
            margin: 0 -16px;
            padding-left: 16px;
            padding-right: 16px;
        }
        
        .task-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border);
            border-radius: 6px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .task-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-name {
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .task-desc {
            font-size: 12px;
            color: var(--text-light);
        }
        
        .task-time {
            font-size: 11px;
            color: var(--text-light);
        }
        
        .task-arrow {
            color: var(--text-light);
            font-size: 14px;
        }
        
        /* Task Detail Form */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text);
        }
        
        .form-hint {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            border-color: var(--primary);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Capture Button */
        .capture-box {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .capture-box:active {
            background: var(--bg);
        }
        
        .capture-box.has-image {
            padding: 10px;
            border-style: solid;
            border-color: var(--success);
        }
        
        .capture-box i {
            font-size: 36px;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .capture-box p {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .capture-box img {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
        }
        
        /* Checklist */
        .checklist-item {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .checklist-item:last-child {
            border-bottom: none;
        }
        
        .checklist-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 4px;
            margin-right: 12px;
            margin-top: 2px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .checklist-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
        }
        
        .checklist-text {
            flex: 1;
            font-size: 14px;
        }
        
        /* Buttons */
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-secondary {
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .stat-card {
            background: var(--card);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 4px;
        }
        
        /* AI Response */
        .ai-response {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .ai-response-title {
            font-size: 13px;
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .ai-response-content {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text);
        }
        
        /* Hidden */
        #camera-input {
            display: none;
        }
        
        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Back Button */
        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--primary);
            margin-bottom: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>ğŸ­ å·¥å‚å·¥ç¨‹å¸ˆåŠ©æ‰‹</h1>
        <div class="time" id="current-time"></div>
    </div>
    
    <!-- Tabs -->
    <div class="tabs">
        <div class="tab active" data-tab="workflow">
            <i class="ri-checkbox-multiple-line"></i>
            å·¥ä½œæµ
        </div>
        <div class="tab" data-tab="ocr">
            <i class="ri-camera-line"></i>
            è¯†åˆ«
        </div>
        <div class="tab" data-tab="history">
            <i class="ri-history-line"></i>
            è®°å½•
        </div>
    </div>
    
    <!-- Workflow Content -->
    <div class="content active" id="workflow">
        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="task-total">6</div>
                <div class="stat-label">æ€»ä»»åŠ¡</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="task-done">2</div>
                <div class="stat-label">å·²å®Œæˆ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="task-progress">33%</div>
                <div class="stat-label">è¿›åº¦</div>
            </div>
        </div>
        
        <!-- Progress -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">ğŸ“‹ ä»Šæ—¥å·¥ä½œæµ</span>
                <span class="status-badge status-processing" id="flow-status">è¿›è¡Œä¸­</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 33%"></div>
            </div>
        </div>
        
        <!-- Tasks -->
        <div class="card" id="task-list">
            <!-- Tasks will be rendered here -->
        </div>
    </div>
    
    <!-- Task Detail Modal -->
    <div class="modal-overlay" id="task-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">ä»»åŠ¡è¯¦æƒ…</div>
                <div class="modal-close" onclick="closeModal()">
                    <i class="ri-close-line"></i>
                </div>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamic Content -->
            </div>
        </div>
    </div>
    
    <!-- OCR Content -->
    <div class="content" id="ocr">
        <div class="card">
            <div class="card-title" style="margin-bottom: 16px;">ğŸ“· å¿«é€Ÿè¯†åˆ«</div>
            
            <div class="form-group">
                <label class="form-label">é€‰æ‹©è¯†åˆ«ç±»å‹</label>
                <select class="form-input" id="ocr-type">
                    <option value="nameplate">è®¾å¤‡é“­ç‰Œ</option>
                    <option value="gauge">ä»ªè¡¨è¯»æ•°</option>
                    <option value="valve">é˜€é—¨æŒ‚ç‰Œ</option>
                    <option value="label">ç®¡é“æ ‡è¯†</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">æ‹æ‘„ç…§ç‰‡</label>
                <div class="capture-box" id="ocr-capture" onclick="captureOCR()">
                    <i class="ri-camera-line"></i>
                    <p>ç‚¹å‡»æ‹ç…§è¯†åˆ«</p>
                </div>
                <input type="file" id="ocr-camera-input" accept="image/*" capture="environment" onchange="handleOCRCapture(event)">
            </div>
            
            <div id="ocr-result-box" style="display: none;">
                <div class="form-group">
                    <label class="form-label">ğŸ“ è¯†åˆ«ç»“æœ</label>
                    <div class="form-input" id="ocr-result-text" style="min-height: 80px; background: #f8fafc;"></div>
                </div>
                <button class="btn btn-primary" onclick="analyzeOCR()">ğŸ¤– AIæ™ºèƒ½åˆ†æ</button>
            </div>
            
            <div id="ocr-ai-result" style="display: none;"></div>
        </div>
    </div>
    
    <!-- History Content -->
    <div class="content" id="history">
        <div class="card">
            <div class="card-title" style="margin-bottom: 16px;">ğŸ“š ä»Šæ—¥è®°å½•</div>
            <div id="history-list">
                <!-- History items -->
            </div>
        </div>
    </div>
    
    <script>
        // Task Data with Details
        let tasks = [
            {
                id: 1,
                name: '8:00 è®¾å¤‡å·¡æ£€',
                desc: 'æ£€æŸ¥AåŒºç©ºå‹æœºè¿è¡ŒçŠ¶æ€',
                time: '08:00',
                done: true,
                type: 'checklist',
                checklist: [
                    { text: 'æ£€æŸ¥ç©ºå‹æœºè¿è¡Œå£°å“', done: true },
                    { text: 'æ£€æŸ¥æ²¹æ°”åˆ†ç¦»å™¨æ²¹ä½', done: true },
                    { text: 'è®°å½•å‡ºå£å‹åŠ›', done: true, value: '0.75 MPa' },
                    { text: 'è®°å½•å‡ºå£æ¸©åº¦', done: true, value: '72â„ƒ' }
                ]
            },
            {
                id: 2,
                name: '9:30 å‹åŠ›å®¹å™¨æ£€æŸ¥',
                desc: 'Bç½åŒºå‹åŠ›è¡¨è¯»æ•°è®°å½•',
                time: '09:30',
                done: true,
                type: 'form',
                fields: [
                    { label: 'ç½åŒºç¼–å·', value: 'B-101' },
                    { label: 'å‹åŠ›è¡¨è¯»æ•° (MPa)', value: '0.45' },
                    { label: 'æ˜¯å¦æ­£å¸¸', value: 'æ­£å¸¸' },
                    { label: 'å¤‡æ³¨', value: '' }
                ]
            },
            {
                id: 3,
                name: '10:00 ç”µæœºæ¸©åº¦æ£€æµ‹',
                desc: 'M-201~M-205 ç”µæœºæ¸©åº¦æµ‹é‡',
                time: '10:00',
                done: false,
                type: 'capture',
                captures: [
                    { label: 'M-201 ç”µæœºæ¸©åº¦', value: '', image: null },
                    { label: 'M-202 ç”µæœºæ¸©åº¦', value: '', image: null },
                    { label: 'M-203 ç”µæœºæ¸©åº¦', value: '', image: null },
                    { label: 'M-204 ç”µæœºæ¸©åº¦', value: '', image: null },
                    { label: 'M-205 ç”µæœºæ¸©åº¦', value: '', image: null }
                ]
            },
            {
                id: 4,
                name: '11:00 é˜€é—¨æŒ‚ç‰Œæ£€æŸ¥',
                desc: 'P-001~P-050 é˜€é—¨æŒ‚ç‰Œå®Œæ•´æ€§',
                time: '11:00',
                done: false,
                type: 'checklist',
                checklist: [
                    { text: 'P-001 é˜€é—¨æŒ‚ç‰Œå®Œå¥½', done: false },
                    { text: 'P-002 é˜€é—¨æŒ‚ç‰Œå®Œå¥½', done: false },
                    { text: 'P-003 é˜€é—¨æŒ‚ç‰Œå®Œå¥½', done: false },
                    { text: 'P-004 é˜€é—¨æŒ‚ç‰Œå®Œå¥½', done: false },
                    { text: 'P-005 é˜€é—¨æŒ‚ç‰Œå®Œå¥½', done: false }
                ]
            },
            {
                id: 5,
                name: '14:00 ä»ªè¡¨æ ¡å‡†è®°å½•',
                desc: 'æµé‡è®¡FT-102æ ¡å‡†æ•°æ®å½•å…¥',
                time: '14:00',
                done: false,
                type: 'form',
                fields: [
                    { label: 'ä»ªè¡¨ç¼–å·', value: 'FT-102' },
                    { label: 'æ ‡å‡†å€¼ (mÂ³/h)', value: '' },
                    { label: 'å®æµ‹å€¼ (mÂ³/h)', value: '' },
                    { label: 'è¯¯å·® (%)', value: '' },
                    { label: 'ç»“è®º', value: '' }
                ]
            },
            {
                id: 6,
                name: '16:00 å·¡æ£€æ€»ç»“',
                desc: 'ç”Ÿæˆå½“æ—¥å·¡æ£€æŠ¥å‘Š',
                time: '16:00',
                done: false,
                type: 'ai',
                prompt: 'ç”Ÿæˆä»Šæ—¥è®¾å¤‡å·¡æ£€æ€»ç»“æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š1. å·¡æ£€æ¦‚å†µ 2. å¼‚å¸¸æƒ…å†µ 3. ç»´æŠ¤å»ºè®®'
            }
        ];
        
        // Render Tasks
        function renderTasks() {
            const taskList = document.getElementById('task-list');
            taskList.innerHTML = tasks.map(task => `
                <div class="task-item" onclick="openTaskDetail(${task.id})">
                    <div class="task-checkbox ${task.done ? 'checked' : ''}">
                        ${task.done ? '<i class="ri-check-line"></i>' : ''}
                    </div>
                    <div class="task-info">
                        <div class="task-name">${task.name}</div>
                        <div class="task-desc">${task.desc}</div>
                    </div>
                    <div class="task-arrow">
                        <i class="ri-arrow-right-s-line"></i>
                    </div>
                </div>
            `).join('');
            
            // Update Stats
            const done = tasks.filter(t => t.done).length;
            const total = tasks.length;
            document.getElementById('task-total').textContent = total;
            document.getElementById('task-done').textContent = done;
            document.getElementById('task-progress').textContent = Math.round(done / total * 100) + '%';
            document.getElementById('progress-fill').style.width = (done / total * 100) + '%';
            
            if (done === total) {
                document.getElementById('flow-status').textContent = 'å…¨éƒ¨å®Œæˆ';
                document.getElementById('flow-status').className = 'status-badge status-done';
            }
            
            // Render History
            renderHistory();
        }
        
        // Render History
        function renderHistory() {
            const doneTasks = tasks.filter(t => t.done);
            const historyList = document.getElementById('history-list');
            
            if (doneTasks.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; color: var(--text-light); padding: 40px;">æš‚æ— å®Œæˆè®°å½•</div>';
                return;
            }
            
            historyList.innerHTML = doneTasks.map(task => `
                <div class="task-item" onclick="openTaskDetail(${task.id})">
                    <div class="task-info">
                        <div class="task-name">${task.name}</div>
                        <div class="task-desc">${task.desc}</div>
                    </div>
                    <span class="status-badge status-done">å·²å®Œæˆ</span>
                </div>
            `).join('');
        }
        
        // Open Task Detail
        function openTaskDetail(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            document.getElementById('modal-title').textContent = task.name;
            const modalBody = document.getElementById('modal-body');
            
            let content = '';
            
            if (task.type === 'checklist') {
                content = renderChecklistTask(task);
            } else if (task.type === 'form') {
                content = renderFormTask(task);
            } else if (task.type === 'capture') {
                content = renderCaptureTask(task);
            } else if (task.type === 'ai') {
                content = renderAITask(task);
            }
            
            modalBody.innerHTML = content;
            document.getElementById('task-modal').classList.add('active');
        }
        
        // Render Checklist Task
        function renderChecklistTask(task) {
            return `
                <div class="form-group">
                    <label class="form-label">${task.desc}</label>
                </div>
                <div class="form-group">
                    ${task.checklist.map((item, idx) => `
                        <div class="checklist-item" onclick="toggleChecklistItem(${task.id}, ${idx})">
                            <div class="checklist-checkbox ${item.done ? 'checked' : ''}"></div>
                            <div class="checklist-text">${item.text}${item.value ? ' - ' + item.value : ''}</div>
                        </div>
                    `).join('')}
                </div>
                <button class="btn btn-success" onclick="completeTask(${task.id})">âœ… å®Œæˆä»»åŠ¡</button>
            `;
        }
        
        // Render Form Task
        function renderFormTask(task) {
            return `
                <div class="form-group">
                    ${task.fields.map((field, idx) => `
                        <label class="form-label">${field.label}</label>
                        <input type="text" class="form-input" id="field-${idx}" 
                            value="${field.value || ''}" 
                            onchange="updateFieldValue(${task.id}, ${idx}, this.value)"
                            ${field.value && field.value !== '' ? 'style="background: #f8fafc;"' : ''}>
                    `).join('')}
                </div>
                <button class="btn btn-success" onclick="completeTask(${task.id})">âœ… å®Œæˆä»»åŠ¡</button>
            `;
        }
        
        // Render Capture Task
        function renderCaptureTask(task) {
            return `
                <div class="form-group">
                    <label class="form-label">${task.desc}</label>
                    <p class="form-hint">ç‚¹å‡»æ¯ä¸ªé¡¹ç›®è¿›è¡Œæ‹ç…§è¯†åˆ«</p>
                </div>
                ${task.captures.map((cap, idx) => `
                    <div class="form-group">
                        <label class="form-label">${cap.label}</label>
                        <div class="capture-box ${cap.image ? 'has-image' : ''}" 
                            onclick="captureItemImage(${task.id}, ${idx})">
                            ${cap.image ? 
                                `<img src="${cap.image}" alt="${cap.label}">
                                <p style="margin-top: 8px;">${cap.value || 'ç‚¹å‡»é‡æ–°æ‹æ‘„'}</p>` :
                                `<i class="ri-camera-line"></i>
                                <p>ç‚¹å‡»æ‹ç…§</p>`
                            }
                        </div>
                    </div>
                `).join('')}
                <button class="btn btn-success" onclick="completeTask(${task.id})">âœ… å®Œæˆä»»åŠ¡</button>
            `;
        }
        
        // Render AI Task
        function renderAITask(task) {
            return `
                <div class="form-group">
                    <label class="form-label">AI æ™ºèƒ½æŠ¥å‘Š</label>
                    <p class="form-hint">${task.desc}</p>
                </div>
                <button class="btn btn-primary" onclick="generateAIReport(${task.id})">
                    ğŸ¤– ç”Ÿæˆå·¡æ£€æŠ¥å‘Š
                </button>
                <div id="ai-report-result"></div>
            `;
        }
        
        // Toggle Checklist
        function toggleChecklistItem(taskId, itemIdx) {
            const task = tasks.find(t => t.id === taskId);
            if (task && task.checklist) {
                task.checklist[itemIdx].done = !task.checklist[itemIdx].done;
                openTaskDetail(taskId); // Re-render
            }
        }
        
        // Update Field Value
        function updateFieldValue(taskId, fieldIdx, value) {
            const task = tasks.find(t => t.id === taskId);
            if (task && task.fields) {
                task.fields[fieldIdx].value = value;
            }
        }
        
        // Capture Item Image
        let currentCaptureTask = null;
        let currentCaptureIdx = null;
        
        function captureItemImage(taskId, idx) {
            currentCaptureTask = taskId;
            currentCaptureIdx = idx;
            document.getElementById('ocr-camera-input').click();
        }
        
        // Handle OCR Capture
        function handleOCRCapture(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // If in task detail mode
                if (currentCaptureTask !== null) {
                    const task = tasks.find(t => t.id === currentCaptureTask);
                    if (task && task.captures) {
                        task.captures[currentCaptureIdx].image = e.target.result;
                        task.captures[currentCaptureIdx].value = (Math.random() * 20 + 60).toFixed(1) + 'â„ƒ';
                        openTaskDetail(currentCaptureTask);
                    }
                    currentCaptureTask = null;
                    currentCaptureIdx = null;
                } else {
                    // OCR tab mode
                    document.getElementById('ocr-capture').innerHTML = `<img src="${e.target.result}" alt="Captured">`;
                    document.getElementById('ocr-capture').classList.add('has-image');
                    document.getElementById('ocr-result-box').style.display = 'block';
                    
                    // Simulate OCR result
                    setTimeout(() => {
                        const ocrType = document.getElementById('ocr-type').value;
                        let result = '';
                        if (ocrType === 'nameplate') {
                            result = `è®¾å¤‡ç¼–å·ï¼šA-001
è®¾å¤‡åç§°ï¼šç©ºæ°”å‹ç¼©æœº
å‹å·ï¼šLU132-8
åŠŸç‡ï¼š132kW
ç”µå‹ï¼š380V
åˆ¶é€ å•†ï¼šé˜¿ç‰¹æ‹‰æ–¯Â·ç§‘æ™®æŸ¯
å‡ºå‚æ—¥æœŸï¼š2020-03`;
                        } else if (ocrType === 'gauge') {
                            result = `å‹åŠ›è¡¨è¯»æ•°ï¼š0.45 MPa
è¡¨å·ï¼šP-102
é‡ç¨‹ï¼š0-1.0MPa
ç²¾åº¦ç­‰çº§ï¼š1.6çº§`;
                        } else {
                            result = `è¯†åˆ«æˆåŠŸï¼Œè¯·ç¡®è®¤å†…å®¹`;
                        }
                        document.getElementById('ocr-result-text').textContent = result;
                    }, 1500);
                }
            };
            reader.readAsDataURL(file);
            event.target.value = '';
        }
        
        // Complete Task
        function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.done = true;
                closeModal();
                renderTasks();
            }
        }
        
        // Generate AI Report
        function generateAIReport(taskId) {
            const resultDiv = document.getElementById('ai-report-result');
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="ai-response">
                        <div class="ai-response-title">
                            <i class="ri-robot-line"></i> ğŸ¤– AI å·¡æ£€æŠ¥å‘Š
                        </div>
                        <div class="ai-response-content">
                            <p><strong>ğŸ“‹ å·¡æ£€æ¦‚å†µ</strong></p>
                            <p>ä»Šæ—¥å…±å®Œæˆè®¾å¤‡å·¡æ£€6é¡¹ï¼Œæ‰€æœ‰è®¾å¤‡è¿è¡Œæ­£å¸¸ã€‚</p>
                            <br>
                            <p><strong>âš ï¸ å¼‚å¸¸æƒ…å†µ</strong></p>
                            <p>æ— å¼‚å¸¸å‘ç°ã€‚å„é¡¹å‚æ•°å‡åœ¨æ­£å¸¸èŒƒå›´å†…ã€‚</p>
                            <br>
                            <p><strong>ğŸ”§ ç»´æŠ¤å»ºè®®</strong></p>
                            <p>1. å»ºè®®4æœˆè¿›è¡Œç©ºå‹æœºå®šæœŸä¿å…»<br>
                            2. é˜€é—¨P-003æŒ‚ç‰Œæœ‰è½»å¾®ç£¨æŸï¼Œå»ºè®®æ›´æ¢<br>
                            3. ç”µæœºM-204æ¸©åº¦ç•¥é«˜(78â„ƒ)ï¼Œå»ºè®®æŒç»­è§‚å¯Ÿ</p>
                        </div>
                    </div>
                    <button class="btn btn-success" style="margin-top: 16px;" onclick="completeTask(${taskId})">âœ… ç¡®è®¤å¹¶å®Œæˆ</button>
                `;
            }, 2000);
        }
        
        // Analyze OCR
        function analyzeOCR() {
            const resultDiv = document.getElementById('ocr-ai-result');
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            resultDiv.style.display = 'block';
            
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="ai-response">
                        <div class="ai-response-title">
                            <i class="ri-robot-line"></i> ğŸ¤– AI åˆ†æå»ºè®®
                        </div>
                        <div class="ai-response-content">
                            <p><strong>ğŸ“Š è¯†åˆ«ä¿¡æ¯æ‘˜è¦</strong></p>
                            <p>è®¾å¤‡ç¼–å·ï¼šA-001 | å‹å·ï¼šLU132-8</p>
                            <br>
                            <p><strong>ğŸ”§ ç»´æŠ¤å»ºè®®</strong></p>
                            <p>1. ä¸‹æ¬¡ä¿å…»ï¼š2026-04-01ï¼ˆå»ºè®®æå‰1å‘¨å®‰æ’ï¼‰<br>
                            2. å·²è¿è¡Œçº¦6å¹´ï¼Œå»ºè®®å…³æ³¨è½´æ‰¿çŠ¶æ€<br>
                            3. è¿è¡Œæ—¶æ³¨æ„ç›‘æµ‹ç”µæµå’Œæ¸©åº¦</p>
                        </div>
                    </div>
                `;
            }, 2000);
        }
        
        // Close Modal
        function closeModal() {
            document.getElementById('task-modal').classList.remove('active');
            currentCaptureTask = null;
            currentCaptureIdx = null;
        }
        
        // Capture OCR
        function captureOCR() {
            document.getElementById('ocr-camera-input').click();
        }
        
        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => switchTab(tab.dataset.tab));
        });
        
        // Update Time
        function updateTime() {
            const now = new Date();
            const options = { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit', 
                minute: '2-digit' 
            };
            document.getElementById('current-time').textContent = now.toLocaleString('zh-CN', options);
        }
        
        // Initialize
        renderTasks();
        updateTime();
        setInterval(updateTime, 60000);
    </script>
</body>
</html>
